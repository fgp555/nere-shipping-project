<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Report</title>
</head>
<body>
  <h1>Create Report</h1>

  <form id="createReportForm">
    <h2>Header</h2>
    <label for="header_name">Header Name:</label>
    <input type="text" id="header_name" value="FLAVIO A. PREZIOSA" required><br>

    <label for="header_address">Header Address:</label>
    <input type="text" id="header_address" value="Habana 2874 - 1419 - Buenos Aires - Argentina" required><br>

    <label for="header_mobile">Header Mobile:</label>
    <input type="text" id="header_mobile" value="M +54 911 6677 2741" required><br>

    <label for="header_email">Header Email:</label>
    <input type="email" id="header_email" value="flaviopreziosa@gmail.com" required><br>

    <div id="containerCodes">
      <label>Container Codes:</label>
      <input type="text" name="container_code" value="FSCU57267991" required>
      <button type="button" onclick="addContainerCode()">Add Container Code</button><br>
    </div>

    <h2>Details Shipment</h2>
    <label for="vessel">Vessel:</label>
    <input type="text" id="vessel" value="XIN CHANG SHA" required><br>

    <label for="voyage">Voyage:</label>
    <input type="text" id="voyage" value="402S" required><br>

    <label for="mbl_code">MBL Code:</label>
    <input type="text" id="mbl_code" value="ONEYHAME90065700" required><br>

    <label for="pol">POL:</label>
    <input type="text" id="pol" value="Hamburg, Germany" required><br>

    <h2>Relevant Times</h2>
    <div id="relevantTimes">
      <label>Relevant Time:</label>
      <input type="text" placeholder="Date" name="relevant_date" value="25-sep-24" required>
      <input type="text" placeholder="Container Code" name="relevant_container_code" value="FSCU57267991" required>
      <input type="number" placeholder="Qty of Pkgs" name="relevant_qty_of_pkgs" value="59" required>
      <button type="button" onclick="addRelevantTime()">Add Relevant Time</button><br>
    </div>

    <h2>Securing Seals</h2>
    <div id="securingSeals">
      <label>Securing Seal:</label>
      <input type="text" placeholder="Container Code" name="seal_container_code" value="FSCU57267991" required>
      <input type="text" placeholder="Type" name="seal_type" value="RF" required>
      <input type="text" placeholder="WWAS Safety Seals" name="seal_wwas_safety_seals" value="01-0265193" required>
      <button type="button" onclick="addSecuringSeal()">Add Securing Seal</button><br>
    </div>

    <h2>Unstuffing Container</h2>
    <div id="unstuffingNotes">
      <label>Notes:</label>
      <input type="text" name="unstuffing_note" value="As soon as the doors of the containers were unsealed/opened, the cargo was observed secured and visually in overall sound condition" required>
      <button type="button" onclick="addUnstuffingNote()">Add Note</button><br>
    </div>

    <div id="unstuffingImages">
      <label>Image Path and Description:</label>
      <input type="text" placeholder="Path" name="image_path" value="https://www.example.com/img01.jpeg" required>
      <input type="text" placeholder="Description" name="image_description" value="Image 1" required>
      <button type="button" onclick="addUnstuffingImage()">Add Image</button><br>
    </div>

    <label for="foot_note">Foot Note:</label>
    <input type="text" id="foot_note" value="Roof panel scratched â€“ refrigerated panel torn / dented." required><br>

    <h2>Pre-existing Damage</h2>
    <div id="damageNotes">
      <label>Damage Notes:</label>
      <input type="text" name="damage_note" value="During the stripping operation, the following exceptions were noticed and/or recorded:" required>
      <button type="button" onclick="addDamageNote()">Add Damage Note</button><br>
    </div>

    <h2>Weather</h2>
    <div id="weatherNotes">
      <label>Weather Notes:</label>
      <input type="text" name="weather_note" value="Hot/cloudy" required>
      <button type="button" onclick="addWeatherNote()">Add Weather Note</button><br>
    </div>

    <label for="temperature">Temperature:</label>
    <input type="number" id="temperature" value="21" required><br>

    <label for="humidity">Humidity:</label>
    <input type="number" id="humidity" value="70" required><br>

    <h2>Footer</h2>
    <div id="footerNotes">
      <label>Footer Notes:</label>
      <input type="text" name="footer_note" value="SIGNED WITHOUT PREJUDICE" required>
      <button type="button" onclick="addFooterNote()">Add Footer Note</button><br>
    </div>

    <button type="submit">Create Report</button>
  </form>

  <script>
    function addContainerCode() {
      const containerCodes = document.getElementById("containerCodes");
      const input = document.createElement("input");
      input.type = "text";
      input.name = "container_code";
      input.required = true;
      containerCodes.appendChild(input);
      containerCodes.appendChild(document.createElement("br"));
    }

    function addRelevantTime() {
      const relevantTimes = document.getElementById("relevantTimes");
      relevantTimes.innerHTML += `
        <input type="text" placeholder="Date" name="relevant_date" required>
        <input type="text" placeholder="Container Code" name="relevant_container_code" required>
        <input type="number" placeholder="Qty of Pkgs" name="relevant_qty_of_pkgs" required>
        <br>
      `;
    }

    function addSecuringSeal() {
      const securingSeals = document.getElementById("securingSeals");
      securingSeals.innerHTML += `
        <input type="text" placeholder="Container Code" name="seal_container_code" required>
        <input type="text" placeholder="Type" name="seal_type" required>
        <input type="text" placeholder="WWAS Safety Seals" name="seal_wwas_safety_seals" required>
        <br>
      `;
    }

    function addUnstuffingNote() {
      const unstuffingNotes = document.getElementById("unstuffingNotes");
      unstuffingNotes.innerHTML += `<input type="text" name="unstuffing_note" required><br>`;
    }

    function addUnstuffingImage() {
      const unstuffingImages = document.getElementById("unstuffingImages");
      unstuffingImages.innerHTML += `
        <input type="text" placeholder="Path" name="image_path" required>
        <input type="text" placeholder="Description" name="image_description" required>
        <br>
      `;
    }

    function addDamageNote() {
      const damageNotes = document.getElementById("damageNotes");
      damageNotes.innerHTML += `<input type="text" name="damage_note" required><br>`;
    }

    function addWeatherNote() {
      const weatherNotes = document.getElementById("weatherNotes");
      weatherNotes.innerHTML += `<input type="text" name="weather_note" required><br>`;
    }

    function addFooterNote() {
      const footerNotes = document.getElementById("footerNotes");
      footerNotes.innerHTML += `<input type="text" name="footer_note" required><br>`;
    }

    document.getElementById('createReportForm').addEventListener('submit', async (event) => {
      event.preventDefault();

      const data = {
        t0_header: {
          header_name: document.getElementById('header_name').value,
          header_address: document.getElementById('header_address').value,
          header_mobile: document.getElementById('header_mobile').value,
          header_email: document.getElementById('header_email').value,
          container_code: Array.from(document.getElementsByName('container_code')).map(input => input.value)
        },
        t1_details_shipment: {
          vessel: document.getElementById('vessel').value,
          voyage: document.getElementById('voyage').value,
          mbl_code: document.getElementById('mbl_code').value,
          pol: document.getElementById('pol').value
        },
        T2_relevant_times: Array.from(document.querySelectorAll('#relevantTimes input')).reduce((acc, input, i, arr) => {
          if (i % 3 === 0) acc.push({});
          acc[acc.length - 1][input.name.replace('relevant_', '')] = i % 3 === 2 ? parseInt(input.value, 10) : input.value;
          return acc;
        }, []),
        t3_securing_seals: Array.from(document.querySelectorAll('#securingSeals input')).reduce((acc, input, i, arr) => {
          if (i % 3 === 0) acc.push({});
          acc[acc.length - 1][input.name.replace('seal_', '')] = input.value;
          return acc;
        }, []),
        t4_unstuffing_container: {
          notes: Array.from(document.getElementsByName('unstuffing_note')).map(input => input.value),
          images: Array.from(document.querySelectorAll('#unstuffingImages input')).reduce((acc, input, i, arr) => {
            if (i % 2 === 0) acc.push({});
            acc[acc.length - 1][input.name.replace('image_', '')] = input.value;
            return acc;
          }, [])
        },
        t5_pre_existing_damage: {
          notes: Array.from(document.getElementsByName('damage_note')).map(input => input.value)
        },
        t6_the_weather: {
          notes: Array.from(document.getElementsByName('weather_note')).map(input => input.value),
          temperature: parseInt(document.getElementById('temperature').value, 10),
          humidity: parseInt(document.getElementById('humidity').value, 10)
        },
        t7_footer: {
          notes: Array.from(document.getElementsByName('footer_note')).map(input => input.value)
        }
      };

      try {
        const response = await fetch('http://localhost:3000/api/report', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await response.json();
        alert(`Report created with ID: ${result.id}`);
      } catch (error) {
        console.error('Error creating report:', error);
      }
    });
  </script>
</body>
</html>
