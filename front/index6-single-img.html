<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Report</title>
  </head>
  <body>
    <h1>Create Report</h1>
    <form id="reportForm" enctype="multipart/form-data">
      <!-- t0_header -->
      <h2>Header</h2>
      <input type="text" name="header_name" placeholder="Header Name" value="FLAVIO A. PREZIOSA" required /><br />
      <input type="text" name="header_address" placeholder="Header Address" value="Habana 2874 - 1419 - Buenos Aires - Argentina" required /><br />
      <input type="text" name="header_mobile" placeholder="Mobile" value="M +54 911 6677 2741" required /><br />
      <input type="email" name="header_email" placeholder="Email" value="flaviopreziosa@gmail.com" required /><br />

      <!-- Container Codes -->
      <div id="containerCodesContainer">
        <div class="container-code"><input type="text" name="container_code" placeholder="Container Code" value="FSCU57267991" required /><br /></div>
      </div>
      <button type="button" onclick="addContainerCode()">Add Another Container Code</button>

      <input type="text" name="report_date" placeholder="Report Date" value="Buenos Aires, 30th September 2024" required /><br />
      <input type="text" name="cliente_senores" placeholder="Cliente Señores" value="Messrs" required /><br />
      <input type="text" name="cliente_empresa" placeholder="Cliente Empresa" value="SACO Shipping GmbH" required /><br />
      <input type="text" name="cliente_deposito" placeholder="Cliente Deposito" value="Wollkammereistr 1" required /><br />
      <input type="text" name="cliente_postal" placeholder="Cliente Postal" value="D-21107 Hamburg" required /><br />
      <input type="text" name="operador_area" placeholder="Operador Area" value="Export & Import operations" required /><br />
      <input type="text" name="operador_responsables1" placeholder="Operador Responsables 1" value="Arne Schulte / Lars Reil" required /><br />
      <input type="text" name="operador_responsables2" placeholder="Operador Responsables 2" value="Gisel Gimenez / Florencia Bavaro" required /><br />
      <input type="text" name="report_mv" placeholder="Report MV" value="m.v. XIN CHANG SHA COMPLETAR" required /><br />
      <input type="text" name="containers_reporte" placeholder="Containers Reporte" value="¨IMPORT CONTAINERS UNSTUFFING REPORT¨" required /><br />
      <input type="text" name="containers_leyenda" placeholder="Containers Leyenda" value="GROUPAGE CONTAINERS" required /><br />
      <input
        type="text"
        name="containers_descripcion"
        placeholder="Containers Descripcion"
        value="1 x 40-ft non-operating reefer container & 1 x 40-ft DV container stuffed with consolidated cargo"
        required
      /><br />
      <input type="text" name="containers_destino" placeholder="Containers Destino" value="Buenos Aires - Argentina" required /><br />
      <textarea name="report_description" placeholder="Report Description" required>In compliance with the instructions given by Messrs. ¨SACO Shipping GmbH¨ - Hamburg...</textarea
      ><br />
      <textarea name="report_note" placeholder="Report Note" required>Given the great amount of pictures taken during this survey...</textarea><br />

      <!-- t1_details_shipment -->
      <h2>Shipment Details</h2>
      <input type="text" name="vessel" placeholder="Vessel" value="XIN CHANG SHA" required /><br />
      <input type="text" name="voyage" placeholder="Voyage" value="402S" required /><br />
      <input type="text" name="mbl_code" placeholder="MBL Code" value="ONEYHAME90065700" required /><br />
      <input type="text" name="pol" placeholder="POL" value="Hamburg, Germany" required /><br />
      <input type="text" name="shipper" placeholder="Shipper" value="SACO Shipping GmbH" required /><br />
      <input type="text" name="pod" placeholder="POD" value="Buenos Aires, Argentina" required /><br />
      <input type="text" name="consignee" placeholder="Consignee" value="SACO Shipping S.A." required /><br />
      <input type="number" name="qty_of_pkgs" placeholder="Qty of Pkgs" value="94" required /><br />
      <input type="text" name="goods" placeholder="Goods" value="Consolidated cargo" required /><br />
      <input type="text" name="gross_weight" placeholder="Gross Weight" value="38,068.90 kg" required /><br />

      <!-- T2_relevant_times -->
      <h2>Relevant Times</h2>
      <div id="relevantTimesContainer">
        <div class="relevant-time">
          <input type="date" name="date_rt" value="2024-09-25" required /><br />
          <input type="text" name="container_code_rt" placeholder="Container Code" value="FSCU57267991" required /><br />
          <input type="number" name="qty_of_pkgs_rt" placeholder="Qty of Pkgs" value="59" required /><br />
          <input type="time" name="start" placeholder="Start Time" value="08:00" required /><br />
          <input type="time" name="complete" placeholder="Complete Time" value="12:00" required /><br />
          <input type="text" name="time_used_to_survey" placeholder="Time Used" value="4 hours" required /><br />
        </div>
      </div>
      <button type="button" onclick="addRelevantTime()">Add Relevant Time</button>

      <!-- t3_securing_seals -->
      <h2>Securing Seals</h2>
      <div id="securingSealsContainer">
        <div class="securing-seal">
          <input type="text" name="container_code_ss" placeholder="Container Code" value="FSCU57267991" required /><br />
          <input type="text" name="type" placeholder="Type" value="RF" required /><br />
          <input type="text" name="wwas_safety_seals" placeholder="WWAS Safety Seals" value="01-0265193" required /><br />
          <input type="text" name="argentinean_customs_seal" placeholder="Argentinean Customs Seal" value="None" required /><br />
          <input type="text" name="others" placeholder="Others" value="None" required /><br />
        </div>
      </div>
      <button type="button" onclick="addSecuringSeal()">Add Securing Seal</button>

      <!-- t4_unstuffing_container -->
      <h2>Unstuffing Container</h2>
      <div id="unstuffingContainerNotes">
        <div class="unstuffing-note"><textarea name="notes" placeholder="Notes" required>As soon as the doors of the containers were unsealed...</textarea><br /></div>
      </div>
      <button type="button" onclick="addUnstuffingNote()">Add Another Note</button>

      <label for="image_path">Upload Images:</label>
      <!-- <input type="file" name="image_path" accept="image/*" multiple required /><br /> -->
      <input type="file" name="image_path" accept="image/*" required /><br />
      <input type="text" name="image_description" placeholder="Image Description" value="Image 1" required /><br />
      <input type="text" name="foot_note" placeholder="Foot Note" value="Roof panel scratched..." required /><br />

      <!-- t5_pre_existing_damage -->
      <h2>Pre-Existing Damage</h2>
      <textarea name="damage_notes" placeholder="Damage Notes" required>During the stripping operation...</textarea><br />
      <input type="text" name="damage_title" placeholder="Damage Title" value=". FSCU57267991 x 40-ft non-operating reefer container" required /><br />
      <input type="text" name="b_l_no" placeholder="B/L No" value="BUE238550" required /><br />
      <input type="text" name="consignee_d" placeholder="Consignee" value="BIO ABA SA" required /><br />
      <input type="text" name="marks" placeholder="Marks" value="29119880" required /><br />
      <input type="number" name="qty_of_pkgs_d" placeholder="Qty of Pkgs" value="2" required /><br />
      <input type="text" name="goods_d" placeholder="Goods" value="Peptones" required /><br />
      <input type="text" name="remarks" placeholder="Remarks" value="1 pallet shrink-wrap film stretch torn off..." required /><br />
      <label for="damage_image_path">Upload Damage Image:</label>
      <input type="file" name="damage_image_path" accept="image/*" required /><br />
      <input type="text" name="damage_image_description" placeholder="Damage Image Description" value="Image 1" required /><br />

      <!-- t6_the_weather -->
      <h2>The Weather</h2>
      <textarea name="weather_notes" placeholder="Weather Notes" required>Hot/cloudy</textarea><br />
      <input type="number" name="temperature" placeholder="Temperature" value="21" required /><br />
      <input type="number" name="humidity" placeholder="Humidity" value="70" required /><br />

      <!-- t7_footer -->
      <h2>Footer</h2>
      <textarea name="footer_notes" placeholder="Footer Notes" required>SIGNED WITHOUT PREJUDICE, Flavio Preziosa, Independent Cargo Surveyor</textarea><br />

      <!-- Submit Button -->
      <button type="submit">Create Report</button>
    </form>

    <pre id="output"></pre>

    <script>
      // ==========  ==========
      function addRelevantTime() {
        const container = document.getElementById("relevantTimesContainer");
        const relevantTimeDiv = document.createElement("div");
        relevantTimeDiv.classList.add("relevant-time");
        relevantTimeDiv.innerHTML = `
    <input type="date" name="date_rt" value="2024-09-25" required /><br />
    <input type="text" name="container_code_rt" placeholder="Container Code" value="FSCU57267991" required /><br />
    <input type="number" name="qty_of_pkgs_rt" placeholder="Qty of Pkgs" value="59" required /><br />
    <input type="time" name="start" placeholder="Start Time" value="08:00" required /><br />
    <input type="time" name="complete" placeholder="Complete Time" value="12:00" required /><br />
    <input type="text" name="time_used_to_survey" placeholder="Time Used" value="4 hours" required /><br />
  `;
        container.appendChild(relevantTimeDiv);
      }

      // ==========  ==========
      function addSecuringSeal() {
        const container = document.getElementById("securingSealsContainer");
        const securingSealDiv = document.createElement("div");
        securingSealDiv.classList.add("securing-seal");
        securingSealDiv.innerHTML = `
    <input type="text" name="container_code_ss" placeholder="Container Code" value="FSCU57267991" required /><br />
    <input type="text" name="type" placeholder="Type" value="RF" required /><br />
    <input type="text" name="wwas_safety_seals" placeholder="WWAS Safety Seals" value="01-0265193" required /><br />
    <input type="text" name="argentinean_customs_seal" placeholder="Argentinean Customs Seal" value="None" required /><br />
    <input type="text" name="others" placeholder="Others" value="None" required /><br />
  `;
        container.appendChild(securingSealDiv);
      }

      // ========== ==========

      function addUnstuffingNote() {
        const container = document.getElementById("unstuffingContainerNotes");
        const noteDiv = document.createElement("div");
        noteDiv.classList.add("unstuffing-note");
        noteDiv.innerHTML = `
    <textarea name="notes" placeholder="Notes" required>Additional note...</textarea><br />
  `;
        container.appendChild(noteDiv);
      }

      // ==========  ==========
      function addContainerCode() {
        const container = document.getElementById("containerCodesContainer");
        const containerCodeDiv = document.createElement("div");
        containerCodeDiv.classList.add("container-code");
        containerCodeDiv.innerHTML = `
    <input type="text" name="container_code" placeholder="Container Code" value="FSCU57267992" required /><br />
  `;
        container.appendChild(containerCodeDiv);
      }

      // ========== ==========

      document.getElementById("reportForm").addEventListener("submit", async (event) => {
        event.preventDefault();

        const formData = new FormData();

        // t0_header
        // Itera sobre cada código de contenedor en Header
        document.querySelectorAll(".container-code input").forEach((code, index) => {
          formData.append(`t0_header[container_code][${index}]`, code.value);
        });

        // Agrega otros campos del Header
        formData.append("t0_header[header_name]", event.target.header_name.value);
        formData.append("t0_header[header_address]", event.target.header_address.value);
        formData.append("t0_header[header_mobile]", event.target.header_mobile.value);
        formData.append("t0_header[header_email]", event.target.header_email.value);
        formData.append("t0_header[report_date]", event.target.report_date.value);
        formData.append("t0_header[cliente_senores]", event.target.cliente_senores.value);
        formData.append("t0_header[cliente_empresa]", event.target.cliente_empresa.value);
        formData.append("t0_header[cliente_deposito]", event.target.cliente_deposito.value);
        formData.append("t0_header[cliente_postal]", event.target.cliente_postal.value);
        formData.append("t0_header[operador_area]", event.target.operador_area.value);
        formData.append("t0_header[operador_responsables1]", event.target.operador_responsables1.value);
        formData.append("t0_header[operador_responsables2]", event.target.operador_responsables2.value);
        formData.append("t0_header[report_mv]", event.target.report_mv.value);
        formData.append("t0_header[containers_reporte]", event.target.containers_reporte.value);
        formData.append("t0_header[containers_leyenda]", event.target.containers_leyenda.value);
        formData.append("t0_header[containers_descripcion]", event.target.containers_descripcion.value);
        formData.append("t0_header[containers_destino]", event.target.containers_destino.value);
        formData.append("t0_header[report_description]", event.target.report_description.value);
        formData.append("t0_header[report_note]", event.target.report_note.value);

        // t1_details_shipment
        formData.append("t1_details_shipment[vessel]", event.target.vessel.value);
        formData.append("t1_details_shipment[voyage]", event.target.voyage.value);
        formData.append("t1_details_shipment[mbl_code]", event.target.mbl_code.value);
        formData.append("t1_details_shipment[pol]", event.target.pol.value);
        formData.append("t1_details_shipment[shipper]", event.target.shipper.value);
        formData.append("t1_details_shipment[pod]", event.target.pod.value);
        formData.append("t1_details_shipment[consignee]", event.target.consignee.value);
        formData.append("t1_details_shipment[qty_of_pkgs]", event.target.qty_of_pkgs.value);
        formData.append("t1_details_shipment[goods]", event.target.goods.value);
        formData.append("t1_details_shipment[gross_weight]", event.target.gross_weight.value);

        // // T2_relevant_times
        // Itera sobre cada conjunto de Relevant Times
        document.querySelectorAll(".relevant-time").forEach((relevantTime, index) => {
          formData.append(`T2_relevant_times[${index}][date]`, relevantTime.querySelector('[name="date_rt"]').value);
          formData.append(`T2_relevant_times[${index}][container_code]`, relevantTime.querySelector('[name="container_code_rt"]').value);
          formData.append(`T2_relevant_times[${index}][qty_of_pkgs]`, relevantTime.querySelector('[name="qty_of_pkgs_rt"]').value);
          formData.append(`T2_relevant_times[${index}][start]`, relevantTime.querySelector('[name="start"]').value);
          formData.append(`T2_relevant_times[${index}][complete]`, relevantTime.querySelector('[name="complete"]').value);
          formData.append(`T2_relevant_times[${index}][time_used_to_survey]`, relevantTime.querySelector('[name="time_used_to_survey"]').value);
        });

        // t3_securing_seals
        // Itera sobre cada conjunto de Securing Seals
        document.querySelectorAll(".securing-seal").forEach((securingSeal, index) => {
          formData.append(`t3_securing_seals[${index}][container_code]`, securingSeal.querySelector('[name="container_code_ss"]').value);
          formData.append(`t3_securing_seals[${index}][type]`, securingSeal.querySelector('[name="type"]').value);
          formData.append(`t3_securing_seals[${index}][wwas_safety_seals]`, securingSeal.querySelector('[name="wwas_safety_seals"]').value);
          formData.append(`t3_securing_seals[${index}][argentinean_customs_seal]`, securingSeal.querySelector('[name="argentinean_customs_seal"]').value);
          formData.append(`t3_securing_seals[${index}][others]`, securingSeal.querySelector('[name="others"]').value);
        });

        // // t4_unstuffing_container
        // Itera sobre cada nota de Unstuffing Container
        document.querySelectorAll(".unstuffing-note textarea").forEach((note, index) => {
          formData.append(`t4_unstuffing_container[notes][${index}]`, note.value);
        });

        // Agregar otros campos de Unstuffing Container
        formData.append("t4_unstuffing_container[image_description]", event.target.image_description.value);
        // Agrega cada imagen seleccionada en image_path
        // const imageFiles = event.target.image_path.files;
        // for (let i = 0; i < imageFiles.length; i++) {
        //   formData.append(`t4_unstuffing_container[images][${i}]`, imageFiles[i]);
        // }

        formData.append("t4_unstuffing_container[foot_note]", event.target.foot_note.value);
        formData.append("t4_unstuffing_container[image]", event.target.image_path.files[0]);

        // t5_pre_existing_damage
        formData.append("t5_pre_existing_damage[notes]", event.target.damage_notes.value);
        formData.append("t5_pre_existing_damage[title]", event.target.damage_title.value);
        formData.append("t5_pre_existing_damage[b_l_no]", event.target.b_l_no.value);
        formData.append("t5_pre_existing_damage[consignee]", event.target.consignee_d.value);
        formData.append("t5_pre_existing_damage[marks]", event.target.marks.value);
        formData.append("t5_pre_existing_damage[qty_of_pkgs]", event.target.qty_of_pkgs_d.value);
        formData.append("t5_pre_existing_damage[goods]", event.target.goods_d.value);
        formData.append("t5_pre_existing_damage[remarks]", event.target.remarks.value);
        formData.append("t5_pre_existing_damage[image]", event.target.damage_image_path.files[0]);
        formData.append("t5_pre_existing_damage[image_description]", event.target.damage_image_description.value);

        // t6_the_weather
        formData.append("t6_the_weather[notes]", event.target.weather_notes.value);
        formData.append("t6_the_weather[temperature]", event.target.temperature.value);
        formData.append("t6_the_weather[humidity]", event.target.humidity.value);

        // t7_footer
        formData.append("t7_footer[notes]", event.target.footer_notes.value);

        const formDataObject = {};
        formData.forEach((value, key) => {
          formDataObject[key] = value;
        });

        console.log("FormData como objeto:", formDataObject);

        try {
          const response = await fetch("/api/report", {
            method: "POST",
            body: formData,
          });
          const data = await response.json();
          alert("Report created successfully: " + JSON.stringify(data));
        } catch (error) {
          alert("Error creating report: " + error);
        }
      });
    </script>
  </body>
</html>
